---
import BaseLayout from '../layouts/BaseLayout.astro';

const allMoments = Object.values(
  import.meta.glob('../pages/moments/*.md', { eager: true })
);

// 按日期排序
allMoments.sort((a: any, b: any) =>
  +new Date(b.frontmatter.date) - +new Date(a.frontmatter.date)
);

const pageTitle = "Moments";
---
<BaseLayout pageTitle={pageTitle}>
  <h1 class="text-2xl font-bold mb-6">动态更新</h1>

  <ul>
    {allMoments.map((post: any) => (
      <li class="mb-10">
        <p class="text-gray-500 text-sm">
          {post.frontmatter.date.toString().slice(0, 10)}
        </p>

        {post.frontmatter.title && (
          <h2 class="text-xl font-semibold mb-2">
            {post.frontmatter.title}
          </h2>
        )}

        {/* 直接渲染 Markdown（自动转 HTML） */}
        <article>
          <post.default />
        </article>

        {/* 如果有图片 */}
        {post.frontmatter.images?.length > 0 && (
          <div class="mt-3 flex flex-wrap gap-3">
            {post.frontmatter.images.map((url: string) => (
              <img src={url} alt="" class="rounded-md w-40" />
            ))}
          </div>
        )}
      </li>
    ))}
  </ul>
</BaseLayout>
